{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 200, 
  "height": 500, 
  "title": {
    "text": "Breakdown of Mines by Commodity Group for Each State",
    "anchor": "middle" 
  },
  "data": {
    "url": "Australia Mines.csv"
  },
  "facet": {
    "field": "State",
    "type": "nominal",
    "title": "State",
    "columns": 4
  }, 
  "spec": {
    "layer": [
      {
        "selection": {
          "commodity_filter": {
            "type": "multi",
            "fields": ["Commodity Group"],
            "bind": "legend"
          }
        },
        "mark": {"type": "arc", "tooltip": true},
        "encoding": {
          "theta": {
            "field": "Commodity Group",
            "aggregate": "count",
            "type": "quantitative",
            "title": "Number of Mines"
          },
          "color": {
            "field": "Commodity Group",
            "type": "nominal",
            "legend": {
              "title": "Commodity Group"
            },
            "scale": {"scheme": "set2"}
          },
          "opacity": {
            "condition": {"selection": "commodity_filter", "value": 1},
            "value": 0.3
          },
          "tooltip": [
            {"field": "Commodity Group", "type": "nominal", "title": "Commodity Group"},
            {"field": "count", "aggregate": "count", "type": "quantitative", "title": "Number of Mines"}
          ]
        }
      },
      {
        "transform": [
          {
            "aggregate": [{"op": "count", "as": "MineCount"}],
            "groupby": ["State", "Commodity Group"]
          },
          {
            "window": [{"op": "max", "field": "MineCount", "as": "MaxMines"}],
            "frame": [null, null],
            "groupby": ["State"]
          },
          {
            "filter": "datum.MineCount == datum.MaxMines"
          },
          {
            "calculate": "datum['Commodity Group'] + '\\nNumber of Mines: ' + datum['MineCount']",
            "as": "Annotation"
          }
        ],
        "mark": {
          "type": "text",
          "align": "center",
          "baseline": "top",
          "fontSize": 12,
          "dy": 120
        },
        "encoding": {
          "text": {"field": "Annotation", "type": "nominal"},
          "color": {"value": "black"}
        }
      }
    ]
  },
  "config": {
    "title": {
      "anchor": "middle"
    }
  }
}
